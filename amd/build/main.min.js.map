{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["define(\r\n    ['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/url', 'core/modal_factory', 'core/modal_events', 'core/templates'],\r\n    function($, AJAX, NOTIFICATION, STR, URL, ModalFactory, ModalEvents, Templates) {\r\n    return {\r\n        debug: 0,\r\n        modal: undefined,\r\n        screenshot: '',\r\n        screenshotname: '',\r\n        triggerSteps: 0,  \r\n        assignSupporter: function(discussionid /*, userid*/){\r\n            var MAIN = this;\r\n            //if (MAIN.debug > 0) //console.log('local_edusupport/main:assignSupporter(discussionid, userid)', discussionid, userid);\r\n                console.log('ajax call');\r\n                // Show a selection of possible supporters.\r\n                AJAX.call([{\r\n                    methodname: 'local_edusupport_get_potentialsupporters',\r\n                    args: { discussionid: discussionid },\r\n                    done: function(result) {\r\n                        try { result = JSON.parse(result); } catch(e) { }\r\n                        if (MAIN.debug > 0) {console.log('local_edusupport_external:local_edusupport_get_potentialsupporters', result);}\r\n                        var supportlevels = Object.keys(result.supporters);\r\n                        var body = '<input type=\"hidden\" value=\"' + discussionid + '\" />';\r\n                        body += '<select>';\r\n                        for (var a = 0; a < supportlevels.length; a++) {\r\n                            body += '<optgroup label=\"' + supportlevels[a] + '\">';\r\n                            for (var b = 0; b < result.supporters[supportlevels[a]].length; b++) {\r\n                                var supporter = result.supporters[supportlevels[a]][b];\r\n                                body += '<option value=\"' + supporter.userid + '\"' + ((supporter.selected)?' selected=\"selected\"':'') + '>' + supporter.firstname + ' ' + supporter.lastname + '</option>';\r\n                            }\r\n                            body += '</optgroup>';\r\n                        }\r\n                        body += '</select>';\r\n\r\n                        //console.log(result);\r\n                        ModalFactory.create({\r\n                            title: STR.get_string('select', 'core'),\r\n                            type: ModalFactory.types.SAVE_CANCEL,\r\n                            body: body,\r\n                            //footer: 'footer',\r\n                        }).done(function(modal) {\r\n                            console.log('Created modal');\r\n                            modal.show();\r\n                            modal.getRoot().on(ModalEvents.save, function(e) {\r\n                                e.preventDefault();\r\n                                var discussionid = $(this).find('.modal-body input').val();\r\n                                var supporterid = $(this).find('.modal-body select').val();\r\n                                var data = { 'discussionid': discussionid, 'supporterid': supporterid };\r\n                                //console.log('Store', this, e, data);\r\n                                AJAX.call([{\r\n                                    methodname: 'local_edusupport_set_currentsupporter',\r\n                                    args: data,\r\n                                    done: function(result) {\r\n                                        console.log(result);\r\n                                        if (result == 1) {\r\n                                            top.location.reload();\r\n                                        } else {\r\n                                            alert('Error: ' + result);\r\n                                        }\r\n                                    },\r\n                                    fail: NOTIFICATION.exception\r\n                                }]);\r\n                            });\r\n                        });\r\n                    },\r\n                    fail: NOTIFICATION.exception\r\n                }]);\r\n\r\n        },\r\n        /**\r\n         * Checks if a particular support form has a screenshot. If not, it hides the modal and creates one.\r\n         */\r\n        checkHasScreenshot: function(c) {\r\n            var MAIN = this;\r\n            if (MAIN.debug > 0) console.log('local_edusupport/main:checkHasScreenshot(c)', c);\r\n            if ($(c).closest(\"form\").find(\"#screenshot\").attr('src') == '') {\r\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"block\");\r\n\r\n            } else {\r\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"none\");\r\n                $(c).closest(\"form\").find(\"#screenshot\").css(\"display\", ($(c).is(\":checked\") ? \"inline\" : \"none\"));\r\n                $(c).closest(\"form\").find(\"#screenshot_new\").css(\"display\", ($(c).is(\":checked\") ? \"block\" : \"none\"));\r\n            }\r\n        },\r\n        /**\r\n         * Generate the screenshot now.\r\n         * @param b the button within the form that was clicked.\r\n         */\r\n        generateScreenshot: function(b) {\r\n            MAIN.modal.hide();\r\n            require(['local_edusupport/html2canvas'], function(h2c) {\r\n                console.log('Making screenshot');\r\n                h2c(document.body).then(function(canvas) {\r\n                    console.log('Got screenshot');\r\n                    MAIN.canvas = canvas;\r\n                    if (typeof MAIN.modal !== 'undefined') {\r\n                        MAIN.prepareScreenshot(b);\r\n                        MAIN.modal.show();\r\n                    }\r\n                });\r\n            });\r\n        },\r\n        /**\r\n         * Inject a help button in the upper right menu.\r\n         */\r\n        injectHelpButton: function() {\r\n            console.log('local_edusupport/main:injectHelpButton()');\r\n            AJAX.call([{\r\n                methodname: 'local_edusupport_get_extralinks',\r\n                args: {},\r\n                done: function(result) {\r\n                    $(result).insertBefore($('nav.fixed-top .nav .nav-item:last-child'));\r\n                },\r\n                fail: NOTIFICATION.exception\r\n            }]);\r\n        },\r\n        /**\r\n         * Scans the page for all discussion posts and adds a reply-button.\r\n         */\r\n        injectReplyButtons: function(discussion) {\r\n            STR.get_strings([\r\n                    {'key' : 'reply', component: 'forum' },\r\n                ]).done(function(s) {\r\n                    // Remove default reply links.\r\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&parent=\"]').remove();\r\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&delete=\"]').remove();\r\n                    $('a[href*=\"post.php?prune=\"]').remove();\r\n                    // Add our customized reply links.\r\n                    $('.forum-post-container>.forumpost').each(function() {\r\n                        var postid = $(this).attr('data-post-id');\r\n                        if ($(this).find('.reply-' + postid).length == 0) {\r\n                            $(this).find('.post-actions:first-child').append(\r\n                                $('<a data-region=\"post-action\" class=\"btn btn-link reply-' + postid + '\" title=\"' + s[0] + '\" aria-label=\"' + s[0] + '\" role=\"menuitem\" tabindex=\"-1\">')\r\n                                    .html(s[0]).attr('href', URL.relativeUrl('/local/edusupport/issue.php?discussion=' + discussion + '&replyto=' + postid + '#mformforum'))\r\n                            );\r\n                        }\r\n                    });\r\n                }\r\n            ).fail(NOTIFICATION.exception);\r\n        },\r\n        /**\r\n         * Close an issue.\r\n        **/\r\n        closeIssue: function(discussionid) {\r\n            console.log('closeIssue(discussionid)', discussionid);\r\n            AJAX.call([{\r\n                methodname: 'local_edusupport_close_issue',\r\n                args: { discussionid: discussionid },\r\n                done: function(result) {\r\n                    console.log(result);\r\n                    if (result == 1) {\r\n                        top.location.href = URL.relativeUrl('/local/edusupport/issues.php', {});\r\n                    } else {\r\n                        NOTIFICATION.exception(result);\r\n                        //alert('Error: ' + result);\r\n                    }\r\n                },\r\n                fail: NOTIFICATION.exception\r\n            }]);\r\n        },\r\n        /**\r\n         * Colorize shown discussions.\r\n        **/\r\n        colorize: function() {\r\n            var discussionids = [];\r\n            $('table.forumheaderlist tr.discussion td.starter a').each(function(){ var d = $(this).attr('href').split('?d='); discussionids[discussionids.length] = d[1]; });\r\n            var data = { discussionids: discussionids };\r\n            console.log('local_edusupport_colorize', data);\r\n            AJAX.call([{\r\n                methodname: 'local_edusupport_colorize',\r\n                args: data,\r\n                done: function(result) {\r\n                    try { result = JSON.parse(result); } catch(e) {}\r\n                    console.log(result);\r\n                    if (typeof result.styles !== 'undefined') {\r\n                        var discussionids = Object.keys(result.styles);\r\n                        for (var a = 0; a < discussionids.length; a++) {\r\n                            var discussionid = discussionids[a];\r\n                            var style = result.styles[discussionid];\r\n                            $('table.forumheaderlist tr.discussion td.starter a[href$=\"d=' + discussionid + '\"]').closest('tr').attr('style', style);\r\n                        }\r\n                    }\r\n                },\r\n                fail: NOTIFICATION.exception\r\n            }]);\r\n        },\r\n        /**\r\n         * Let's inject a button to call the 2nd level support.\r\n         * @param discussionid.\r\n         * @param isissue determines if this issue is already at higher support levels.\r\n         */\r\n        injectForwardButton: function(discussionid, isissue) {\r\n            if (this.debug) console.log('local_edusupport/main:injectForwardButton(discussionid, isissue)', discussionid, isissue);\r\n            if (typeof discussionid === 'undefined') return;\r\n            STR.get_strings([\r\n                    {'key' : (typeof isissue !== 'undefined' && isissue) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\r\n                ]).done(function(s) {\r\n                    $('#page-content div[role=\"main\"] .discussionname').parent().prepend(\r\n                        $('<a href=\"#\">')\r\n                                    .attr('onclick', \"require(['local_edusupport/main'], function(MAIN) { MAIN.injectForwardModal(\" + discussionid + \", \" + isissue + \"); }); return false;\")\r\n                                    .attr('style', 'float: right')\r\n                                    .addClass(\"btn btn-secondary\")\r\n                                    .html(s[0])\r\n                    );\r\n                }\r\n            ).fail(NOTIFICATION.exception);\r\n        },\r\n        injectTest: function() {\r\n            var discussionname = $(\".discussionname\");\r\n            if(discussionname.text().substr(0,2) == \"! \") {\r\n                discussionname.addClass(\"alert-warning\");\r\n            }\r\n             if(discussionname.text().substr(0,2) == \"!!\") {\r\n                discussionname.addClass(\"alert-danger\");\r\n            }\r\n\r\n\r\n        },\r\n        injectForwardModal: function(discussionid, revoke) {\r\n            STR.get_strings([\r\n                    {'key' : 'confirm', component: 'core' },\r\n                    {'key' : (typeof revoke !== 'undefined' && revoke) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\r\n                ]).done(function(s) {\r\n                    ModalFactory.create({\r\n                        type: ModalFactory.types.SAVE_CANCEL,\r\n                        title: s[0],\r\n                        body: s[1],\r\n                    })\r\n                    .done(function(modal) {\r\n                        var root = modal.getRoot();\r\n                        root.on(ModalEvents.save, function() {\r\n                            top.location.href = URL.relativeUrl('/local/edusupport/forward_2nd_level.php', { d: discussionid, revoke: revoke });\r\n                        });\r\n                        modal.show();\r\n                    });\r\n                }\r\n            ).fail(NOTIFICATION.exception);\r\n        },\r\n        postBox: function(modal) {\r\n            var MAIN = this;\r\n            if (typeof MAIN.is_sending !== 'undefined' && MAIN.is_sending) {\r\n                console.log('Issue in queue, aborting');\r\n                return;\r\n            }\r\n            if (MAIN.debug > 0) console.log('MAIN.postBox(modal)', modal);\r\n            var subject = $('#local_edusupport_create_form #id_subject').val();\r\n            var contactphone = $('#local_edusupport_create_form #id_contactphone').val() || '';\r\n            console.log(contactphone);\r\n            var description = $('#local_edusupport_create_form #id_description').val();\r\n            var forum_group = $('#local_edusupport_create_form #id_forum_group').val();\r\n            var postto2ndlevel = $('#local_edusupport_create_form #id_postto2ndlevel').prop('checked') ? 1 : 0;\r\n            var post_screenshot = true; // $('#local_edusupport_create_form #id_postscreenshot').prop('checked') ? 1 : 0;\r\n            var screenshot = MAIN.screenshot; // $('#local_edusupport_create_form img#screenshot').attr('src');\r\n            var screenshotname = MAIN.screenshotname;\r\n            var faqread = $('#local_edusupport_create_form #id_faqread').prop('checked') ? 1 : 0;\r\n            var guestmail = $('#local_edusupport_create_form #id_guestmail').length ? $('#local_edusupport_create_form #id_guestmail').val() : null;\r\n            /*var priority = $('#local_edusupport_create_form #id_prioritylvl').val();\r\n            subject = priority + \" \" + subject;\r\n            console.log.subject; */\r\n            var url = top.location.href;\r\n            console.log('')\r\n            if (faqread  == 0) {\r\n                var editaPresent = STR.get_string('faqread', 'local_edusupport', {});\r\n                $.when(editaPresent).done(function(localizedEditString) {\r\n                    NOTIFICATION.alert('', localizedEditString);\r\n                });\r\n                return;\r\n            }\r\n            if (subject.length == 0) {\r\n                var editaPresent = STR.get_string('select_subject', 'local_edusupport', {});\r\n                $.when(editaPresent).done(function(localizedEditString) {\r\n                    NOTIFICATION.alert('', localizedEditString);\r\n                });\r\n                return;\r\n            }\r\n            if (subject.length < 3 || description.length < 5) {\r\n                var editaPresent = STR.get_string('be_more_accurate', 'local_edusupport', {});\r\n                $.when(editaPresent).done(function(localizedEditString) {\r\n                    NOTIFICATION.alert('', localizedEditString);\r\n                });\r\n                return;\r\n            }\r\n\r\n            MAIN.is_sending = true;\r\n\r\n            var imagedataurl = (post_screenshot && typeof screenshot !== 'undefined' ) ? screenshot : '';\r\n            console.log(guestmail);\r\n            if (MAIN.debug > 0) console.log('local_edusupport_create_issue', { subject: subject, description: description, forum_group: forum_group,\r\n                 postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname, url: url, contactphone: contactphone, guestmail: guestmail});\r\n            AJAX.call([{\r\n                methodname: 'local_edusupport_create_issue',\r\n                args: { subject: subject, description: description, forum_group: forum_group, postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname,\r\n                     url: url, contactphone: contactphone, guestmail: guestmail},\r\n                done: function(result) {\r\n                    // result is the discussion id, -999 if sent by mail, or -1. if > 0 show confirm box that redirects to post. if -1 show error.\r\n                    if (MAIN.debug > 0) console.log(result);\r\n                    modal.hide();\r\n\r\n                    var responsibles = '';\r\n                    if (typeof result.responsibles !== 'undefined') {\r\n                        responsibles += '<ul class=\"edusupport_responsible\">';\r\n                        for (var i = 0; i < result.responsibles.length; i++) {\r\n                            var r = result.responsibles[i];\r\n                            if (typeof r.userid !== 'undefined' && r.userid > 0) {\r\n                                responsibles += '<li><a href=\"' + URL.fileUrl('/user', 'view.php?id=' + r.userid) + '\" target=\"_blank\">' + r.name + '</a></li>';\r\n                            } else if (typeof r.email !== 'undefined' && r.email != '') {\r\n                                responsibles += '<li><a href=\"mailto:' + r.email + '\">' + r.name + '</a></li>';\r\n                            } else {\r\n                                responsibles += '<li>' + r.name + '</li>';\r\n                            }\r\n                        }\r\n                        responsibles += '</ul>';\r\n                    }\r\n                    if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) == -999) {\r\n                        // confirmation, was sent by mail.\r\n                        STR.get_strings([\r\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\r\n                            {'key' : 'create_issue_success_description_mail', component: 'local_edusupport'},\r\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\r\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\r\n                            ]).done(function(s) {\r\n                                var desc = s[1];\r\n                                if (responsibles != '') {\r\n                                    desc = s[2] + responsibles;\r\n                                }\r\n                                NOTIFICATION.alert(s[0], desc, s[3]);\r\n                            }\r\n                        ).fail(NOTIFICATION.exception);\r\n                    } else if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) > 0) {\r\n                        // confirmation\r\n                        STR.get_strings([\r\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\r\n                            {'key' : 'create_issue_success_description', component: 'local_edusupport'},\r\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\r\n                            {'key' : 'create_issue_success_goto', component: 'local_edusupport' },\r\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\r\n                            ]).done(function(s) {\r\n                                var desc = s[1];\r\n                                if (responsibles != '') {\r\n                                    desc = s[2] + responsibles;\r\n                                }\r\n                                NOTIFICATION.confirm(s[0], desc, s[3], s[4], function(){ top.location.href = URL.fileUrl('/mod/forum', 'discuss.php?d=' + result.discussionid); });\r\n                            }\r\n                        ).fail(NOTIFICATION.exception);\r\n                    } else {\r\n                        STR.get_strings([\r\n                                {'key' : 'create_issue_error_title', component: 'local_edusupport' },\r\n                                {'key' : 'create_issue_error_description', component: 'local_edusupport' },\r\n                            ]).done(function(s) {\r\n                                NOTIFICATION.alert(s[0], s[1]);\r\n                            }\r\n                        ).fail(NOTIFICATION.exception);\r\n                    }\r\n                    MAIN.is_sending = false;\r\n                },\r\n                fail: NOTIFICATION.exception\r\n            }]);\r\n        },\r\n        prepareBox: function() {\r\n            var MAIN = this;\r\n            if (MAIN.debug > 0) console.log('Showing modal');\r\n            var body = $(MAIN.modal.body);\r\n            if (body.find('#id_forum_group>option').length <= 1) {\r\n                body.find('#id_forum_group').parent().parent().css('display', 'none');\r\n            }\r\n\r\n            MAIN.modal.setLarge();\r\n\r\n            MAIN.modal.getRoot().on(ModalEvents.save, function(e) {\r\n                // Stop the default save button behaviour which is to close the modal.\r\n                MAIN.postBox(MAIN.modal);\r\n                e.preventDefault();\r\n                // Do your form validation here.\r\n            });\r\n            var editaPresent = STR.get_string('create_issue', 'local_edusupport', {});\r\n            $.when(editaPresent).done(function(localizedEditString) {\r\n                MAIN.modal.setSaveButtonText(localizedEditString);\r\n            });\r\n            /*$('#id_postscreenshot').closest('div.fitem').css('display', 'none');\r\n            $('#screenshot').closest('div').css('display', 'none');\r\n*/\r\n            MAIN.modal.show();\r\n        },\r\n        /**\r\n         * Insert screenshot to form.\r\n         */\r\n        prepareScreenshot: function(c){\r\n            var MAIN = this;\r\n            var dataurl = MAIN.canvas.toDataURL();\r\n            var body = $(MAIN.modal.body);\r\n            body.find('img#screenshot').attr('src', dataurl);\r\n            $('#screenshot').closest('div').css('display', undefined);\r\n            $('#id_postscreenshot').closest('div.fitem').css('display', undefined);\r\n            MAIN.checkHasScreenshot($('#id_postscreenshot'));\r\n            // delete canvas - next time we want a new screenshot!\r\n            delete(MAIN.canvas);\r\n        },\r\n        showBox: function(forumid){\r\n            if (typeof forumid === 'undefined') forumid = 0;\r\n            var MAIN = this;\r\n            // @todo no functional requirement that screenshot works.\r\n            // @todo screenshot creation parallel to modal?\r\n            // @todo save modal in object for manipulation\r\n            delete(MAIN.canvas);\r\n\r\n            if (typeof MAIN.modal !== 'undefined') {\r\n                MAIN.prepareBox(forumid);\r\n            } else {\r\n                console.log('Fetching modal');\r\n                MAIN.triggerSpinner(1);\r\n                AJAX.call([{\r\n                    methodname: 'local_edusupport_create_form',\r\n                    args: { url: top.location.href, image: '', forumid: forumid },\r\n                    done: function(result) {\r\n                        console.log('Got modal');\r\n                        MAIN.triggerSpinner(-1);\r\n                        // Remove any previously created forms.\r\n                        $('#local_edusupport_create_form').remove();\r\n                        //console.log(result);\r\n                        ModalFactory.create({\r\n                            //title: 'create issue',\r\n                            type: ModalFactory.types.SAVE_CANCEL,\r\n                            body: result,\r\n                            large: 1,\r\n                            //footer: 'footer',\r\n                        }).done(function(modal) {\r\n                            console.log('Created modal');\r\n                            MAIN.modal = modal;\r\n\r\n                            MAIN.prepareBox();\r\n                        });\r\n                    },\r\n                    fail: NOTIFICATION.exception\r\n                }]);\r\n            }\r\n        },\r\n        showSupporter: function(forumid){\r\n            if (typeof forumid === 'undefined') forumid = 0;\r\n            var MAIN = this;\r\n            // @todo no functional requirement that screenshot works.\r\n            // @todo screenshot creation parallel to modal?\r\n            // @todo save modal in object for manipulation\r\n            delete(MAIN.canvas);\r\n            if (typeof MAIN.modal !== 'undefined') {\r\n                MAIN.prepareBox(forumid);\r\n            } else {\r\n                console.log('Fetching modal');\r\n                MAIN.triggerSpinner(1);\r\n                AJAX.call([{\r\n                    methodname: 'local_edusupport_create_form',\r\n                    args: { url: top.location.href, image: '', forumid: forumid },\r\n                    done: function(result) {\r\n                        console.log('Got modal');\r\n                        MAIN.triggerSpinner(-1);\r\n                        // Remove any previously created forms.\r\n                        $('#local_edusupport_create_form').remove();\r\n                        //console.log(result);\r\n                        ModalFactory.create({\r\n                            //title: 'create issue',\r\n                            type: ModalFactory.types.SAVE_CANCEL,\r\n                            body: result,\r\n                            large: 1,\r\n                            //footer: 'footer',\r\n                        }).done(function(modal) {\r\n                            console.log('Created modal');\r\n                            MAIN.modal = modal;\r\n                            MAIN.prepareBox();\r\n                        });\r\n                    },\r\n                    fail: NOTIFICATION.exception\r\n                }]);\r\n            }\r\n        },\r\n\r\n        supportCourseMovedAlert: function(title, msg) {\r\n            ModalFactory.create({\r\n                title: title,\r\n                type: ModalFactory.types.OK,\r\n                body: msg,\r\n                //footer: 'footer',\r\n            }).done(function(modal) {\r\n                modal.show();\r\n            });\r\n        },\r\n        triggerSpinner: function(steps) {\r\n            MAIN = this;\r\n            MAIN.triggerSteps += steps;\r\n            if (MAIN.triggerSteps > 0) {\r\n                if ($('body #edusupport-spinner').length == 0) {\r\n                    $('body').append($('<div id=\"edusupport-spinner\" class=\"spinner-grid show\"><div></div><div></div><div></div><div></div></div>'));\r\n                }\r\n            } else {\r\n                $('#edusupport-spinner').remove();\r\n            }\r\n        },\r\n        uploadScreenshot: function() {\r\n            MAIN = this;\r\n            $('#edusupport_screenshot input').addClass('disabled');\r\n            $('#edusupport_screenshot div.alert').addClass('hidden');\r\n            var file = document.querySelector('#edusupport_screenshot input[type=\"file\"]').files[0];\r\n            var reader = new FileReader();\r\n            reader.readAsDataURL(file);\r\n            if (typeof file.name !== 'undefined') {\r\n                MAIN.screenshotname = file.name;\r\n                reader.onload = function () {\r\n                    $('#edusupport_screenshot div.alert-success').removeClass('hidden');\r\n                    $('#edusupport_screenshot input').removeClass('disabled');\r\n                    MAIN.screenshot = reader.result;\r\n                    console.log(reader.result);\r\n                };\r\n                reader.onerror = function (error) {\r\n                    $('#edusupport_screenshot div.alert-danger').removeClass('hidden');\r\n                    $('#edusupport_screenshot input').removeClass('disabled');\r\n\r\n                    console.log('Error: ', error, file);\r\n                };\r\n            }\r\n        },\r\n    };\r\n});\r\n\r\nfunction changeStatus() {\r\n    var selectValue = document.querySelector(\"#statusChange1\").value;\r\n    Ajax.call([{\r\n        methodname: \"local_edusupport_set_status\",\r\n        args: { status: selectValue},\r\n        done: function(data) {\r\n            if (data.status == false) {\r\n                return;\r\n            }\r\n        },\r\n        fail: function(ex) {\r\n            // eslint-disable-next-line no-console\r\n            console.log(\"ex:\" + ex);\r\n        },\r\n    }]);\r\n\r\n       \r\n}\r\n\r\n"],"names":["define","$","AJAX","NOTIFICATION","STR","URL","ModalFactory","ModalEvents","Templates","debug","modal","undefined","screenshot","screenshotname","triggerSteps","assignSupporter","discussionid","MAIN","this","console","log","call","methodname","args","done","result","JSON","parse","e","supportlevels","Object","keys","supporters","body","a","length","b","supporter","userid","selected","firstname","lastname","create","title","get_string","type","types","SAVE_CANCEL","show","getRoot","on","save","preventDefault","data","find","val","top","location","reload","alert","fail","exception","checkHasScreenshot","c","closest","attr","css","is","generateScreenshot","hide","require","h2c","document","then","canvas","prepareScreenshot","injectHelpButton","insertBefore","injectReplyButtons","discussion","get_strings","component","s","remove","each","postid","append","html","relativeUrl","closeIssue","href","colorize","discussionids","d","split","styles","style","injectForwardButton","isissue","parent","prepend","addClass","injectTest","discussionname","text","substr","injectForwardModal","revoke","postBox","is_sending","subject","contactphone","description","forum_group","postto2ndlevel","prop","faqread","guestmail","url","editaPresent","when","localizedEditString","imagedataurl","image","responsibles","i","r","fileUrl","name","email","parseInt","desc","confirm","prepareBox","setLarge","setSaveButtonText","dataurl","toDataURL","showBox","forumid","triggerSpinner","large","showSupporter","supportCourseMovedAlert","msg","OK","steps","uploadScreenshot","file","querySelector","files","reader","FileReader","readAsDataURL","onload","removeClass","onerror","error"],"mappings":"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"}