{"version":3,"sources":["../src/main.js"],"names":["define","$","AJAX","NOTIFICATION","STR","URL","ModalFactory","ModalEvents","debug","modal","screenshot","screenshotname","triggerSteps","assignSupporter","discussionid","MAIN","console","log","call","methodname","args","done","result","JSON","parse","e","supportlevels","Object","keys","supporters","body","a","length","b","supporter","userid","selected","firstname","lastname","create","title","get_string","type","types","SAVE_CANCEL","show","getRoot","on","save","preventDefault","find","val","supporterid","top","location","reload","alert","fail","exception","checkHasScreenshot","c","closest","attr","css","is","generateScreenshot","hide","require","h2c","document","then","canvas","prepareScreenshot","injectHelpButton","insertBefore","injectReplyButtons","discussion","get_strings","component","s","remove","each","postid","append","html","relativeUrl","closeIssue","href","colorize","discussionids","d","split","data","styles","style","injectForwardButton","isissue","parent","prepend","addClass","injectTest","discussionname","text","substr","injectForwardModal","revoke","root","postBox","is_sending","subject","contactphone","description","forum_group","postto2ndlevel","prop","faqread","url","editaPresent","when","localizedEditString","imagedataurl","image","responsibles","i","r","fileUrl","name","email","parseInt","desc","confirm","prepareBox","setLarge","setSaveButtonText","dataurl","toDataURL","showBox","forumid","triggerSpinner","large","showSupporter","supportCourseMovedAlert","msg","OK","steps","uploadScreenshot","file","querySelector","files","reader","FileReader","readAsDataURL","onload","removeClass","onerror","error"],"mappings":"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","sourcesContent":["define(\n    ['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/url', 'core/modal_factory', 'core/modal_events', 'core/templates'],\n    function($, AJAX, NOTIFICATION, STR, URL, ModalFactory, ModalEvents, Templates) {\n    return {\n        debug: 0,\n        modal: undefined,\n        screenshot: '',\n        screenshotname: '',\n        triggerSteps: 0,\n        assignSupporter: function(discussionid /*, userid*/){\n            var MAIN = this;\n            //if (MAIN.debug > 0) //console.log('local_edusupport/main:assignSupporter(discussionid, userid)', discussionid, userid);\n                console.log('ajax call');\n                // Show a selection of possible supporters.\n                AJAX.call([{\n                    methodname: 'local_edusupport_get_potentialsupporters',\n                    args: { discussionid: discussionid },\n                    done: function(result) {\n                        try { result = JSON.parse(result); } catch(e) { }\n                        if (MAIN.debug > 0) {console.log('local_edusupport_external:local_edusupport_get_potentialsupporters', result);}\n                        var supportlevels = Object.keys(result.supporters);\n                        var body = '<input type=\"hidden\" value=\"' + discussionid + '\" />';\n                        body += '<select>';\n                        for (var a = 0; a < supportlevels.length; a++) {\n                            body += '<optgroup label=\"' + supportlevels[a] + '\">';\n                            for (var b = 0; b < result.supporters[supportlevels[a]].length; b++) {\n                                var supporter = result.supporters[supportlevels[a]][b];\n                                body += '<option value=\"' + supporter.userid + '\"' + ((supporter.selected)?' selected=\"selected\"':'') + '>' + supporter.firstname + ' ' + supporter.lastname + '</option>';\n                            }\n                            body += '</optgroup>';\n                        }\n                        body += '</select>';\n\n                        //console.log(result);\n                        ModalFactory.create({\n                            title: STR.get_string('select', 'core'),\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: body,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            modal.show();\n                            modal.getRoot().on(ModalEvents.save, function(e) {\n                                e.preventDefault();\n                                var discussionid = $(this).find('.modal-body input').val();\n                                var supporterid = $(this).find('.modal-body select').val();\n                                var data = { 'discussionid': discussionid, 'supporterid': supporterid };\n                                //console.log('Store', this, e, data);\n                                AJAX.call([{\n                                    methodname: 'local_edusupport_set_currentsupporter',\n                                    args: data,\n                                    done: function(result) {\n                                        console.log(result);\n                                        if (result == 1) {\n                                            top.location.reload();\n                                        } else {\n                                            alert('Error: ' + result);\n                                        }\n                                    },\n                                    fail: NOTIFICATION.exception\n                                }]);\n                            });\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n\n        },\n        /**\n         * Checks if a particular support form has a screenshot. If not, it hides the modal and creates one.\n         */\n        checkHasScreenshot: function(c) {\n            var MAIN = this;\n            if (MAIN.debug > 0) console.log('local_edusupport/main:checkHasScreenshot(c)', c);\n            if ($(c).closest(\"form\").find(\"#screenshot\").attr('src') == '') {\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"block\");\n\n            } else {\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"none\");\n                $(c).closest(\"form\").find(\"#screenshot\").css(\"display\", ($(c).is(\":checked\") ? \"inline\" : \"none\"));\n                $(c).closest(\"form\").find(\"#screenshot_new\").css(\"display\", ($(c).is(\":checked\") ? \"block\" : \"none\"));\n            }\n        },\n        /**\n         * Generate the screenshot now.\n         * @param b the button within the form that was clicked.\n         */\n        generateScreenshot: function(b) {\n            MAIN.modal.hide();\n            require(['local_edusupport/html2canvas'], function(h2c) {\n                console.log('Making screenshot');\n                h2c(document.body).then(function(canvas) {\n                    console.log('Got screenshot');\n                    MAIN.canvas = canvas;\n                    if (typeof MAIN.modal !== 'undefined') {\n                        MAIN.prepareScreenshot(b);\n                        MAIN.modal.show();\n                    }\n                });\n            });\n        },\n        /**\n         * Inject a help button in the upper right menu.\n         */\n        injectHelpButton: function() {\n            console.log('local_edusupport/main:injectHelpButton()');\n            AJAX.call([{\n                methodname: 'local_edusupport_get_extralinks',\n                args: {},\n                done: function(result) {\n                    $(result).insertBefore($('nav.fixed-top .nav .nav-item:last-child'));\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Scans the page for all discussion posts and adds a reply-button.\n         */\n        injectReplyButtons: function(discussion) {\n            STR.get_strings([\n                    {'key' : 'reply', component: 'forum' },\n                ]).done(function(s) {\n                    // Remove default reply links.\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&parent=\"]').remove();\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&delete=\"]').remove();\n                    $('a[href*=\"post.php?prune=\"]').remove();\n                    // Add our customized reply links.\n                    $('.forum-post-container>.forumpost').each(function() {\n                        var postid = $(this).attr('data-post-id');\n                        if ($(this).find('.reply-' + postid).length == 0) {\n                            $(this).find('.post-actions:first-child').append(\n                                $('<a data-region=\"post-action\" class=\"btn btn-link reply-' + postid + '\" title=\"' + s[0] + '\" aria-label=\"' + s[0] + '\" role=\"menuitem\" tabindex=\"-1\">')\n                                    .html(s[0]).attr('href', URL.relativeUrl('/local/edusupport/issue.php?discussion=' + discussion + '&replyto=' + postid))\n                            );\n                        }\n                    });\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        /**\n         * Close an issue.\n        **/\n        closeIssue: function(discussionid) {\n            console.log('closeIssue(discussionid)', discussionid);\n            AJAX.call([{\n                methodname: 'local_edusupport_close_issue',\n                args: { discussionid: discussionid },\n                done: function(result) {\n                    console.log(result);\n                    if (result == 1) {\n                        top.location.href = URL.relativeUrl('/local/edusupport/issues.php', {});\n                    } else {\n                        NOTIFICATION.exception(result);\n                        //alert('Error: ' + result);\n                    }\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Colorize shown discussions.\n        **/\n        colorize: function() {\n            var discussionids = [];\n            $('table.forumheaderlist tr.discussion td.starter a').each(function(){ var d = $(this).attr('href').split('?d='); discussionids[discussionids.length] = d[1]; });\n            var data = { discussionids: discussionids };\n            console.log('local_edusupport_colorize', data);\n            AJAX.call([{\n                methodname: 'local_edusupport_colorize',\n                args: data,\n                done: function(result) {\n                    try { result = JSON.parse(result); } catch(e) {}\n                    console.log(result);\n                    if (typeof result.styles !== 'undefined') {\n                        var discussionids = Object.keys(result.styles);\n                        for (var a = 0; a < discussionids.length; a++) {\n                            var discussionid = discussionids[a];\n                            var style = result.styles[discussionid];\n                            $('table.forumheaderlist tr.discussion td.starter a[href$=\"d=' + discussionid + '\"]').closest('tr').attr('style', style);\n                        }\n                    }\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Let's inject a button to call the 2nd level support.\n         * @param discussionid.\n         * @param isissue determines if this issue is already at higher support levels.\n         */\n        injectForwardButton: function(discussionid, isissue) {\n            if (this.debug) console.log('local_edusupport/main:injectForwardButton(discussionid, isissue)', discussionid, isissue);\n            if (typeof discussionid === 'undefined') return;\n            STR.get_strings([\n                    {'key' : (typeof isissue !== 'undefined' && isissue) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\n                ]).done(function(s) {\n                    $('#page-content div[role=\"main\"] .discussionname').parent().prepend(\n                        $('<a href=\"#\">')\n                                    .attr('onclick', \"require(['local_edusupport/main'], function(MAIN) { MAIN.injectForwardModal(\" + discussionid + \", \" + isissue + \"); }); return false;\")\n                                    .attr('style', 'float: right')\n                                    .addClass(\"btn btn-secondary\")\n                                    .html(s[0])\n                    );\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        injectTest: function() {\n            var discussionname = $(\".discussionname\");\n            if(discussionname.text().substr(0,2) == \"! \") {\n                discussionname.addClass(\"alert-warning\");\n            }\n             if(discussionname.text().substr(0,2) == \"!!\") {\n                discussionname.addClass(\"alert-danger\");\n            }\n\n\n        },\n        injectForwardModal: function(discussionid, revoke) {\n            STR.get_strings([\n                    {'key' : 'confirm', component: 'core' },\n                    {'key' : (typeof revoke !== 'undefined' && revoke) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\n                ]).done(function(s) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: s[0],\n                        body: s[1],\n                    })\n                    .done(function(modal) {\n                        var root = modal.getRoot();\n                        root.on(ModalEvents.save, function() {\n                            top.location.href = URL.relativeUrl('/local/edusupport/forward_2nd_level.php', { d: discussionid, revoke: revoke });\n                        });\n                        modal.show();\n                    });\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        postBox: function(modal) {\n            var MAIN = this;\n            if (typeof MAIN.is_sending !== 'undefined' && MAIN.is_sending) {\n                console.log('Issue in queue, aborting');\n                return;\n            }\n            if (MAIN.debug > 0) console.log('MAIN.postBox(modal)', modal);\n            var subject = $('#local_edusupport_create_form #id_subject').val();\n            var contactphone = $('#local_edusupport_create_form #id_contactphone').val() || '';\n            console.log(contactphone);\n            var description = $('#local_edusupport_create_form #id_description').val();\n            var forum_group = $('#local_edusupport_create_form #id_forum_group').val();\n            var postto2ndlevel = $('#local_edusupport_create_form #id_postto2ndlevel').prop('checked') ? 1 : 0;\n            var post_screenshot = true; // $('#local_edusupport_create_form #id_postscreenshot').prop('checked') ? 1 : 0;\n            var screenshot = MAIN.screenshot; // $('#local_edusupport_create_form img#screenshot').attr('src');\n            var screenshotname = MAIN.screenshotname;\n            var faqread = $('#local_edusupport_create_form #id_faqread').prop('checked') ? 1 : 0;\n            /*var priority = $('#local_edusupport_create_form #id_prioritylvl').val();\n            subject = priority + \" \" + subject;\n            console.log.subject; */\n            var url = top.location.href;\n\n            if (faqread  == 0) {\n                var editaPresent = STR.get_string('faqread', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n            if (subject.length == 0) {\n                var editaPresent = STR.get_string('select_subject', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n            if (subject.length < 3 || description.length < 5) {\n                var editaPresent = STR.get_string('be_more_accurate', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n\n            MAIN.is_sending = true;\n\n            var imagedataurl = (post_screenshot && typeof screenshot !== 'undefined' ) ? screenshot : '';\n            if (MAIN.debug > 0) console.log('local_edusupport_create_issue', { subject: subject, description: description, forum_group: forum_group, postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname, url: url, contactphone: contactphone });\n            AJAX.call([{\n                methodname: 'local_edusupport_create_issue',\n                args: { subject: subject, description: description, forum_group: forum_group, postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname, url: url, contactphone: contactphone },\n                done: function(result) {\n                    // result is the discussion id, -999 if sent by mail, or -1. if > 0 show confirm box that redirects to post. if -1 show error.\n                    if (MAIN.debug > 0) console.log(result);\n                    modal.hide();\n\n                    var responsibles = '';\n                    if (typeof result.responsibles !== 'undefined') {\n                        responsibles += '<ul class=\"edusupport_responsible\">';\n                        for (var i = 0; i < result.responsibles.length; i++) {\n                            var r = result.responsibles[i];\n                            if (typeof r.userid !== 'undefined' && r.userid > 0) {\n                                responsibles += '<li><a href=\"' + URL.fileUrl('/user', 'view.php?id=' + r.userid) + '\" target=\"_blank\">' + r.name + '</a></li>';\n                            } else if (typeof r.email !== 'undefined' && r.email != '') {\n                                responsibles += '<li><a href=\"mailto:' + r.email + '\">' + r.name + '</a></li>';\n                            } else {\n                                responsibles += '<li>' + r.name + '</li>';\n                            }\n                        }\n                        responsibles += '</ul>';\n                    }\n                    if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) == -999) {\n                        // confirmation, was sent by mail.\n                        STR.get_strings([\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_description_mail', component: 'local_edusupport'},\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                var desc = s[1];\n                                if (responsibles != '') {\n                                    desc = s[2] + responsibles;\n                                }\n                                NOTIFICATION.alert(s[0], desc, s[3]);\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    } else if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) > 0) {\n                        // confirmation\n                        STR.get_strings([\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_description', component: 'local_edusupport'},\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_goto', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                var desc = s[1];\n                                if (responsibles != '') {\n                                    desc = s[2] + responsibles;\n                                }\n                                NOTIFICATION.confirm(s[0], desc, s[3], s[4], function(){ top.location.href = URL.fileUrl('/mod/forum', 'discuss.php?d=' + result.discussionid); });\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    } else {\n                        STR.get_strings([\n                                {'key' : 'create_issue_error_title', component: 'local_edusupport' },\n                                {'key' : 'create_issue_error_description', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                NOTIFICATION.alert(s[0], s[1]);\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    }\n                    MAIN.is_sending = false;\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        prepareBox: function() {\n            var MAIN = this;\n            if (MAIN.debug > 0) console.log('Showing modal');\n            var body = $(MAIN.modal.body);\n            if (body.find('#id_forum_group>option').length <= 1) {\n                body.find('#id_forum_group').parent().parent().css('display', 'none');\n            }\n\n            MAIN.modal.setLarge();\n\n            MAIN.modal.getRoot().on(ModalEvents.save, function(e) {\n                // Stop the default save button behaviour which is to close the modal.\n                MAIN.postBox(MAIN.modal);\n                e.preventDefault();\n                // Do your form validation here.\n            });\n            var editaPresent = STR.get_string('create_issue', 'local_edusupport', {});\n            $.when(editaPresent).done(function(localizedEditString) {\n                MAIN.modal.setSaveButtonText(localizedEditString);\n            });\n            /*$('#id_postscreenshot').closest('div.fitem').css('display', 'none');\n            $('#screenshot').closest('div').css('display', 'none');\n*/\n            MAIN.modal.show();\n        },\n        /**\n         * Insert screenshot to form.\n         */\n        prepareScreenshot: function(c){\n            var MAIN = this;\n            var dataurl = MAIN.canvas.toDataURL();\n            var body = $(MAIN.modal.body);\n            body.find('img#screenshot').attr('src', dataurl);\n            $('#screenshot').closest('div').css('display', undefined);\n            $('#id_postscreenshot').closest('div.fitem').css('display', undefined);\n            MAIN.checkHasScreenshot($('#id_postscreenshot'));\n            // delete canvas - next time we want a new screenshot!\n            delete(MAIN.canvas);\n        },\n        showBox: function(forumid){\n            if (typeof forumid === 'undefined') forumid = 0;\n            var MAIN = this;\n            // @todo no functional requirement that screenshot works.\n            // @todo screenshot creation parallel to modal?\n            // @todo save modal in object for manipulation\n            delete(MAIN.canvas);\n\n            if (typeof MAIN.modal !== 'undefined') {\n                MAIN.prepareBox(forumid);\n            } else {\n                console.log('Fetching modal');\n                MAIN.triggerSpinner(1);\n                AJAX.call([{\n                    methodname: 'local_edusupport_create_form',\n                    args: { url: top.location.href, image: '', forumid: forumid },\n                    done: function(result) {\n                        console.log('Got modal');\n                        MAIN.triggerSpinner(-1);\n                        // Remove any previously created forms.\n                        $('#local_edusupport_create_form').remove();\n                        //console.log(result);\n                        ModalFactory.create({\n                            //title: 'create issue',\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: result,\n                            large: 1,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            MAIN.modal = modal;\n\n                            MAIN.prepareBox();\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n            }\n        },\n        showSupporter: function(forumid){\n            if (typeof forumid === 'undefined') forumid = 0;\n            var MAIN = this;\n            // @todo no functional requirement that screenshot works.\n            // @todo screenshot creation parallel to modal?\n            // @todo save modal in object for manipulation\n            delete(MAIN.canvas);\n            if (typeof MAIN.modal !== 'undefined') {\n                MAIN.prepareBox(forumid);\n            } else {\n                console.log('Fetching modal');\n                MAIN.triggerSpinner(1);\n                AJAX.call([{\n                    methodname: 'local_edusupport_create_form',\n                    args: { url: top.location.href, image: '', forumid: forumid },\n                    done: function(result) {\n                        console.log('Got modal');\n                        MAIN.triggerSpinner(-1);\n                        // Remove any previously created forms.\n                        $('#local_edusupport_create_form').remove();\n                        //console.log(result);\n                        ModalFactory.create({\n                            //title: 'create issue',\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: result,\n                            large: 1,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            MAIN.modal = modal;\n                            MAIN.prepareBox();\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n            }\n        },\n\n        supportCourseMovedAlert: function(title, msg) {\n            ModalFactory.create({\n                title: title,\n                type: ModalFactory.types.OK,\n                body: msg,\n                //footer: 'footer',\n            }).done(function(modal) {\n                modal.show();\n            });\n        },\n        triggerSpinner: function(steps) {\n            MAIN = this;\n            MAIN.triggerSteps += steps;\n            if (MAIN.triggerSteps > 0) {\n                if ($('body #edusupport-spinner').length == 0) {\n                    $('body').append($('<div id=\"edusupport-spinner\" class=\"spinner-grid show\"><div></div><div></div><div></div><div></div></div>'));\n                }\n            } else {\n                $('#edusupport-spinner').remove();\n            }\n        },\n        uploadScreenshot: function() {\n            MAIN = this;\n            $('#edusupport_screenshot input').addClass('disabled');\n            $('#edusupport_screenshot div.alert').addClass('hidden');\n            var file = document.querySelector('#edusupport_screenshot input[type=\"file\"]').files[0];\n            var reader = new FileReader();\n            reader.readAsDataURL(file);\n            if (typeof file.name !== 'undefined') {\n                MAIN.screenshotname = file.name;\n                reader.onload = function () {\n                    $('#edusupport_screenshot div.alert-success').removeClass('hidden');\n                    $('#edusupport_screenshot input').removeClass('disabled');\n                    MAIN.screenshot = reader.result;\n                    console.log(reader.result);\n                };\n                reader.onerror = function (error) {\n                    $('#edusupport_screenshot div.alert-danger').removeClass('hidden');\n                    $('#edusupport_screenshot input').removeClass('disabled');\n\n                    console.log('Error: ', error, file);\n                };\n            }\n        },\n    };\n});\n"],"file":"main.min.js"}