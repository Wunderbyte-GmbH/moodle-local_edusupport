{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["define(\n    ['jquery', 'core/ajax', 'core/notification', 'core/str', 'core/url', 'core/modal_factory', 'core/modal_events', 'core/templates'],\n    function($, AJAX, NOTIFICATION, STR, URL, ModalFactory, ModalEvents, Templates) {\n    return {\n        debug: 0,\n        modal: undefined,\n        screenshot: '',\n        screenshotname: '',\n        triggerSteps: 0,\n        assignSupporter: function(discussionid /*, userid*/){\n            var MAIN = this;\n            //if (MAIN.debug > 0) //console.log('local_edusupport/main:assignSupporter(discussionid, userid)', discussionid, userid);\n                console.log('ajax call');\n                // Show a selection of possible supporters.\n                AJAX.call([{\n                    methodname: 'local_edusupport_get_potentialsupporters',\n                    args: { discussionid: discussionid },\n                    done: function(result) {\n                        try { result = JSON.parse(result); } catch(e) { }\n                        if (MAIN.debug > 0) {console.log('local_edusupport_external:local_edusupport_get_potentialsupporters', result);}\n                        var supportlevels = Object.keys(result.supporters);\n                        var body = '<input type=\"hidden\" value=\"' + discussionid + '\" />';\n                        body += '<select>';\n                        for (var a = 0; a < supportlevels.length; a++) {\n                            body += '<optgroup label=\"' + supportlevels[a] + '\">';\n                            for (var b = 0; b < result.supporters[supportlevels[a]].length; b++) {\n                                var supporter = result.supporters[supportlevels[a]][b];\n                                body += '<option value=\"' + supporter.userid + '\"' + ((supporter.selected)?' selected=\"selected\"':'') + '>' + supporter.firstname + ' ' + supporter.lastname + '</option>';\n                            }\n                            body += '</optgroup>';\n                        }\n                        body += '</select>';\n\n                        //console.log(result);\n                        ModalFactory.create({\n                            title: STR.get_string('select', 'core'),\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: body,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            modal.show();\n                            modal.getRoot().on(ModalEvents.save, function(e) {\n                                e.preventDefault();\n                                var discussionid = $(this).find('.modal-body input').val();\n                                var supporterid = $(this).find('.modal-body select').val();\n                                var data = { 'discussionid': discussionid, 'supporterid': supporterid };\n                                //console.log('Store', this, e, data);\n                                AJAX.call([{\n                                    methodname: 'local_edusupport_set_currentsupporter',\n                                    args: data,\n                                    done: function(result) {\n                                        console.log(result);\n                                        if (result == 1) {\n                                            top.location.reload();\n                                        } else {\n                                            alert('Error: ' + result);\n                                        }\n                                    },\n                                    fail: NOTIFICATION.exception\n                                }]);\n                            });\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n\n        },\n        /**\n         * Checks if a particular support form has a screenshot. If not, it hides the modal and creates one.\n         */\n        checkHasScreenshot: function(c) {\n            var MAIN = this;\n            if (MAIN.debug > 0) console.log('local_edusupport/main:checkHasScreenshot(c)', c);\n            if ($(c).closest(\"form\").find(\"#screenshot\").attr('src') == '') {\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"block\");\n\n            } else {\n                $(c).closest(\"form\").find('#screenshot_ok').css(\"display\", \"none\");\n                $(c).closest(\"form\").find(\"#screenshot\").css(\"display\", ($(c).is(\":checked\") ? \"inline\" : \"none\"));\n                $(c).closest(\"form\").find(\"#screenshot_new\").css(\"display\", ($(c).is(\":checked\") ? \"block\" : \"none\"));\n            }\n        },\n        /**\n         * Generate the screenshot now.\n         * @param b the button within the form that was clicked.\n         */\n        generateScreenshot: function(b) {\n            MAIN.modal.hide();\n            require(['local_edusupport/html2canvas'], function(h2c) {\n                console.log('Making screenshot');\n                h2c(document.body).then(function(canvas) {\n                    console.log('Got screenshot');\n                    MAIN.canvas = canvas;\n                    if (typeof MAIN.modal !== 'undefined') {\n                        MAIN.prepareScreenshot(b);\n                        MAIN.modal.show();\n                    }\n                });\n            });\n        },\n        /**\n         * Inject a help button in the upper right menu.\n         */\n        injectHelpButton: function() {\n            console.log('local_edusupport/main:injectHelpButton()');\n            AJAX.call([{\n                methodname: 'local_edusupport_get_extralinks',\n                args: {},\n                done: function(result) {\n                    $(result).insertBefore($('nav.fixed-top .nav .nav-item:last-child'));\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Scans the page for all discussion posts and adds a reply-button.\n         */\n        injectReplyButtons: function(discussion) {\n            STR.get_strings([\n                    {'key' : 'reply', component: 'forum' },\n                ]).done(function(s) {\n                    // Remove default reply links.\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&parent=\"]').remove();\n                    $('a[href*=\"issue.php?discussion=' + discussion + '&delete=\"]').remove();\n                    $('a[href*=\"post.php?prune=\"]').remove();\n                    // Add our customized reply links.\n                    $('.forum-post-container>.forumpost').each(function() {\n                        var postid = $(this).attr('data-post-id');\n                        if ($(this).find('.reply-' + postid).length == 0) {\n                            $(this).find('.post-actions:first-child').append(\n                                $('<a data-region=\"post-action\" class=\"btn btn-link reply-' + postid + '\" title=\"' + s[0] + '\" aria-label=\"' + s[0] + '\" role=\"menuitem\" tabindex=\"-1\">')\n                                    .html(s[0]).attr('href', URL.relativeUrl('/local/edusupport/issue.php?discussion=' + discussion + '&replyto=' + postid))\n                            );\n                        }\n                    });\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        /**\n         * Close an issue.\n        **/\n        closeIssue: function(discussionid) {\n            console.log('closeIssue(discussionid)', discussionid);\n            AJAX.call([{\n                methodname: 'local_edusupport_close_issue',\n                args: { discussionid: discussionid },\n                done: function(result) {\n                    console.log(result);\n                    if (result == 1) {\n                        top.location.href = URL.relativeUrl('/local/edusupport/issues.php', {});\n                    } else {\n                        NOTIFICATION.exception(result);\n                        //alert('Error: ' + result);\n                    }\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Colorize shown discussions.\n        **/\n        colorize: function() {\n            var discussionids = [];\n            $('table.forumheaderlist tr.discussion td.starter a').each(function(){ var d = $(this).attr('href').split('?d='); discussionids[discussionids.length] = d[1]; });\n            var data = { discussionids: discussionids };\n            console.log('local_edusupport_colorize', data);\n            AJAX.call([{\n                methodname: 'local_edusupport_colorize',\n                args: data,\n                done: function(result) {\n                    try { result = JSON.parse(result); } catch(e) {}\n                    console.log(result);\n                    if (typeof result.styles !== 'undefined') {\n                        var discussionids = Object.keys(result.styles);\n                        for (var a = 0; a < discussionids.length; a++) {\n                            var discussionid = discussionids[a];\n                            var style = result.styles[discussionid];\n                            $('table.forumheaderlist tr.discussion td.starter a[href$=\"d=' + discussionid + '\"]').closest('tr').attr('style', style);\n                        }\n                    }\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        /**\n         * Let's inject a button to call the 2nd level support.\n         * @param discussionid.\n         * @param isissue determines if this issue is already at higher support levels.\n         */\n        injectForwardButton: function(discussionid, isissue) {\n            if (this.debug) console.log('local_edusupport/main:injectForwardButton(discussionid, isissue)', discussionid, isissue);\n            if (typeof discussionid === 'undefined') return;\n            STR.get_strings([\n                    {'key' : (typeof isissue !== 'undefined' && isissue) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\n                ]).done(function(s) {\n                    $('#page-content div[role=\"main\"] .discussionname').parent().prepend(\n                        $('<a href=\"#\">')\n                                    .attr('onclick', \"require(['local_edusupport/main'], function(MAIN) { MAIN.injectForwardModal(\" + discussionid + \", \" + isissue + \"); }); return false;\")\n                                    .attr('style', 'float: right')\n                                    .addClass(\"btn btn-secondary\")\n                                    .html(s[0])\n                    );\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        injectTest: function() {\n            var discussionname = $(\".discussionname\");\n            if(discussionname.text().substr(0,2) == \"! \") {\n                discussionname.addClass(\"alert-warning\");\n            }\n             if(discussionname.text().substr(0,2) == \"!!\") {\n                discussionname.addClass(\"alert-danger\");\n            }\n\n\n        },\n        injectForwardModal: function(discussionid, revoke) {\n            STR.get_strings([\n                    {'key' : 'confirm', component: 'core' },\n                    {'key' : (typeof revoke !== 'undefined' && revoke) ? 'issue_revoke' : 'issue_assign_nextlevel', component: 'local_edusupport' },\n                ]).done(function(s) {\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: s[0],\n                        body: s[1],\n                    })\n                    .done(function(modal) {\n                        var root = modal.getRoot();\n                        root.on(ModalEvents.save, function() {\n                            top.location.href = URL.relativeUrl('/local/edusupport/forward_2nd_level.php', { d: discussionid, revoke: revoke });\n                        });\n                        modal.show();\n                    });\n                }\n            ).fail(NOTIFICATION.exception);\n        },\n        postBox: function(modal) {\n            var MAIN = this;\n            if (typeof MAIN.is_sending !== 'undefined' && MAIN.is_sending) {\n                console.log('Issue in queue, aborting');\n                return;\n            }\n            if (MAIN.debug > 0) console.log('MAIN.postBox(modal)', modal);\n            var subject = $('#local_edusupport_create_form #id_subject').val();\n            var contactphone = $('#local_edusupport_create_form #id_contactphone').val() || '';\n            console.log(contactphone);\n            var description = $('#local_edusupport_create_form #id_description').val();\n            var forum_group = $('#local_edusupport_create_form #id_forum_group').val();\n            var postto2ndlevel = $('#local_edusupport_create_form #id_postto2ndlevel').prop('checked') ? 1 : 0;\n            var post_screenshot = true; // $('#local_edusupport_create_form #id_postscreenshot').prop('checked') ? 1 : 0;\n            var screenshot = MAIN.screenshot; // $('#local_edusupport_create_form img#screenshot').attr('src');\n            var screenshotname = MAIN.screenshotname;\n            var faqread = $('#local_edusupport_create_form #id_faqread').prop('checked') ? 1 : 0;\n            var guestmail = $('#local_edusupport_create_form #id_guestmail').val();\n            /*var priority = $('#local_edusupport_create_form #id_prioritylvl').val();\n            subject = priority + \" \" + subject;\n            console.log.subject; */\n            var url = top.location.href;\n\n            if (faqread  == 0) {\n                var editaPresent = STR.get_string('faqread', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n            if (subject.length == 0) {\n                var editaPresent = STR.get_string('select_subject', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n            if (subject.length < 3 || description.length < 5) {\n                var editaPresent = STR.get_string('be_more_accurate', 'local_edusupport', {});\n                $.when(editaPresent).done(function(localizedEditString) {\n                    NOTIFICATION.alert('', localizedEditString);\n                });\n                return;\n            }\n\n            MAIN.is_sending = true;\n\n            var imagedataurl = (post_screenshot && typeof screenshot !== 'undefined' ) ? screenshot : '';\n            if (MAIN.debug > 0) console.log('local_edusupport_create_issue', { subject: subject, description: description, forum_group: forum_group,\n                 postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname, url: url, contactphone: contactphone, guestmail: guestmail});\n            AJAX.call([{\n                methodname: 'local_edusupport_create_issue',\n                args: { subject: subject, description: description, forum_group: forum_group, postto2ndlevel: postto2ndlevel, image: imagedataurl, screenshotname: screenshotname,\n                     url: url, contactphone: contactphone, guestmail: guestmail},\n                done: function(result) {\n                    // result is the discussion id, -999 if sent by mail, or -1. if > 0 show confirm box that redirects to post. if -1 show error.\n                    if (MAIN.debug > 0) console.log(result);\n                    modal.hide();\n\n                    var responsibles = '';\n                    if (typeof result.responsibles !== 'undefined') {\n                        responsibles += '<ul class=\"edusupport_responsible\">';\n                        for (var i = 0; i < result.responsibles.length; i++) {\n                            var r = result.responsibles[i];\n                            if (typeof r.userid !== 'undefined' && r.userid > 0) {\n                                responsibles += '<li><a href=\"' + URL.fileUrl('/user', 'view.php?id=' + r.userid) + '\" target=\"_blank\">' + r.name + '</a></li>';\n                            } else if (typeof r.email !== 'undefined' && r.email != '') {\n                                responsibles += '<li><a href=\"mailto:' + r.email + '\">' + r.name + '</a></li>';\n                            } else {\n                                responsibles += '<li>' + r.name + '</li>';\n                            }\n                        }\n                        responsibles += '</ul>';\n                    }\n                    if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) == -999) {\n                        // confirmation, was sent by mail.\n                        STR.get_strings([\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_description_mail', component: 'local_edusupport'},\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                var desc = s[1];\n                                if (responsibles != '') {\n                                    desc = s[2] + responsibles;\n                                }\n                                NOTIFICATION.alert(s[0], desc, s[3]);\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    } else if (typeof result.discussionid !== 'undefined' && parseInt(result.discussionid) > 0) {\n                        // confirmation\n                        STR.get_strings([\n                            {'key' : 'create_issue_success_title', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_description', component: 'local_edusupport'},\n                            {'key' : 'create_issue_success_responsibles', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_goto', component: 'local_edusupport' },\n                            {'key' : 'create_issue_success_close', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                var desc = s[1];\n                                if (responsibles != '') {\n                                    desc = s[2] + responsibles;\n                                }\n                                NOTIFICATION.confirm(s[0], desc, s[3], s[4], function(){ top.location.href = URL.fileUrl('/mod/forum', 'discuss.php?d=' + result.discussionid); });\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    } else {\n                        STR.get_strings([\n                                {'key' : 'create_issue_error_title', component: 'local_edusupport' },\n                                {'key' : 'create_issue_error_description', component: 'local_edusupport' },\n                            ]).done(function(s) {\n                                NOTIFICATION.alert(s[0], s[1]);\n                            }\n                        ).fail(NOTIFICATION.exception);\n                    }\n                    MAIN.is_sending = false;\n                },\n                fail: NOTIFICATION.exception\n            }]);\n        },\n        prepareBox: function() {\n            var MAIN = this;\n            if (MAIN.debug > 0) console.log('Showing modal');\n            var body = $(MAIN.modal.body);\n            if (body.find('#id_forum_group>option').length <= 1) {\n                body.find('#id_forum_group').parent().parent().css('display', 'none');\n            }\n\n            MAIN.modal.setLarge();\n\n            MAIN.modal.getRoot().on(ModalEvents.save, function(e) {\n                // Stop the default save button behaviour which is to close the modal.\n                MAIN.postBox(MAIN.modal);\n                e.preventDefault();\n                // Do your form validation here.\n            });\n            var editaPresent = STR.get_string('create_issue', 'local_edusupport', {});\n            $.when(editaPresent).done(function(localizedEditString) {\n                MAIN.modal.setSaveButtonText(localizedEditString);\n            });\n            /*$('#id_postscreenshot').closest('div.fitem').css('display', 'none');\n            $('#screenshot').closest('div').css('display', 'none');\n*/\n            MAIN.modal.show();\n        },\n        /**\n         * Insert screenshot to form.\n         */\n        prepareScreenshot: function(c){\n            var MAIN = this;\n            var dataurl = MAIN.canvas.toDataURL();\n            var body = $(MAIN.modal.body);\n            body.find('img#screenshot').attr('src', dataurl);\n            $('#screenshot').closest('div').css('display', undefined);\n            $('#id_postscreenshot').closest('div.fitem').css('display', undefined);\n            MAIN.checkHasScreenshot($('#id_postscreenshot'));\n            // delete canvas - next time we want a new screenshot!\n            delete(MAIN.canvas);\n        },\n        showBox: function(forumid){\n            if (typeof forumid === 'undefined') forumid = 0;\n            var MAIN = this;\n            // @todo no functional requirement that screenshot works.\n            // @todo screenshot creation parallel to modal?\n            // @todo save modal in object for manipulation\n            delete(MAIN.canvas);\n\n            if (typeof MAIN.modal !== 'undefined') {\n                MAIN.prepareBox(forumid);\n            } else {\n                console.log('Fetching modal');\n                MAIN.triggerSpinner(1);\n                AJAX.call([{\n                    methodname: 'local_edusupport_create_form',\n                    args: { url: top.location.href, image: '', forumid: forumid },\n                    done: function(result) {\n                        console.log('Got modal');\n                        MAIN.triggerSpinner(-1);\n                        // Remove any previously created forms.\n                        $('#local_edusupport_create_form').remove();\n                        //console.log(result);\n                        ModalFactory.create({\n                            //title: 'create issue',\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: result,\n                            large: 1,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            MAIN.modal = modal;\n\n                            MAIN.prepareBox();\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n            }\n        },\n        showSupporter: function(forumid){\n            if (typeof forumid === 'undefined') forumid = 0;\n            var MAIN = this;\n            // @todo no functional requirement that screenshot works.\n            // @todo screenshot creation parallel to modal?\n            // @todo save modal in object for manipulation\n            delete(MAIN.canvas);\n            if (typeof MAIN.modal !== 'undefined') {\n                MAIN.prepareBox(forumid);\n            } else {\n                console.log('Fetching modal');\n                MAIN.triggerSpinner(1);\n                AJAX.call([{\n                    methodname: 'local_edusupport_create_form',\n                    args: { url: top.location.href, image: '', forumid: forumid },\n                    done: function(result) {\n                        console.log('Got modal');\n                        MAIN.triggerSpinner(-1);\n                        // Remove any previously created forms.\n                        $('#local_edusupport_create_form').remove();\n                        //console.log(result);\n                        ModalFactory.create({\n                            //title: 'create issue',\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            body: result,\n                            large: 1,\n                            //footer: 'footer',\n                        }).done(function(modal) {\n                            console.log('Created modal');\n                            MAIN.modal = modal;\n                            MAIN.prepareBox();\n                        });\n                    },\n                    fail: NOTIFICATION.exception\n                }]);\n            }\n        },\n\n        supportCourseMovedAlert: function(title, msg) {\n            ModalFactory.create({\n                title: title,\n                type: ModalFactory.types.OK,\n                body: msg,\n                //footer: 'footer',\n            }).done(function(modal) {\n                modal.show();\n            });\n        },\n        triggerSpinner: function(steps) {\n            MAIN = this;\n            MAIN.triggerSteps += steps;\n            if (MAIN.triggerSteps > 0) {\n                if ($('body #edusupport-spinner').length == 0) {\n                    $('body').append($('<div id=\"edusupport-spinner\" class=\"spinner-grid show\"><div></div><div></div><div></div><div></div></div>'));\n                }\n            } else {\n                $('#edusupport-spinner').remove();\n            }\n        },\n        uploadScreenshot: function() {\n            MAIN = this;\n            $('#edusupport_screenshot input').addClass('disabled');\n            $('#edusupport_screenshot div.alert').addClass('hidden');\n            var file = document.querySelector('#edusupport_screenshot input[type=\"file\"]').files[0];\n            var reader = new FileReader();\n            reader.readAsDataURL(file);\n            if (typeof file.name !== 'undefined') {\n                MAIN.screenshotname = file.name;\n                reader.onload = function () {\n                    $('#edusupport_screenshot div.alert-success').removeClass('hidden');\n                    $('#edusupport_screenshot input').removeClass('disabled');\n                    MAIN.screenshot = reader.result;\n                    console.log(reader.result);\n                };\n                reader.onerror = function (error) {\n                    $('#edusupport_screenshot div.alert-danger').removeClass('hidden');\n                    $('#edusupport_screenshot input').removeClass('disabled');\n\n                    console.log('Error: ', error, file);\n                };\n            }\n        },\n    };\n});\n"],"names":["define","$","AJAX","NOTIFICATION","STR","URL","ModalFactory","ModalEvents","Templates","debug","modal","undefined","screenshot","screenshotname","triggerSteps","assignSupporter","discussionid","MAIN","this","console","log","call","methodname","args","done","result","JSON","parse","e","supportlevels","Object","keys","supporters","body","a","length","b","supporter","userid","selected","firstname","lastname","create","title","get_string","type","types","SAVE_CANCEL","show","getRoot","on","save","preventDefault","data","find","val","top","location","reload","alert","fail","exception","checkHasScreenshot","c","closest","attr","css","is","generateScreenshot","hide","require","h2c","document","then","canvas","prepareScreenshot","injectHelpButton","insertBefore","injectReplyButtons","discussion","get_strings","component","s","remove","each","postid","append","html","relativeUrl","closeIssue","href","colorize","discussionids","d","split","styles","style","injectForwardButton","isissue","parent","prepend","addClass","injectTest","discussionname","text","substr","injectForwardModal","revoke","postBox","is_sending","subject","contactphone","description","forum_group","postto2ndlevel","prop","faqread","guestmail","url","editaPresent","when","localizedEditString","imagedataurl","image","responsibles","i","r","fileUrl","name","email","parseInt","desc","confirm","prepareBox","setLarge","setSaveButtonText","dataurl","toDataURL","showBox","forumid","triggerSpinner","large","showSupporter","supportCourseMovedAlert","msg","OK","steps","uploadScreenshot","file","querySelector","files","reader","FileReader","readAsDataURL","onload","removeClass","onerror","error"],"mappings":"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"}